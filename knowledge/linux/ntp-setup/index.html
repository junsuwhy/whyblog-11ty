<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="WhyBlog - åˆ†äº«æŠ€è¡“èˆ‡ç”Ÿæ´»çš„å€‹äººéƒ¨è½æ ¼">
  <title>Debianï¼Ubuntu ä½¿ç”¨ systemdâ€‘timesyncd èª¿æ•´ NTP Server å®Œæ•´æ•™å­¸ | WhyBlog</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="logo-container">
        <h1 class="site-title"><a href="/"><i class="fas fa-terminal"></i> WhyBlog</a></h1>
      </div>
      <nav class="main-nav">
        <button class="menu-toggle" aria-label="Toggle menu">
          <span class="hamburger"></span>
        </button>
        <ul class="nav-links">
          <li><a href="/blog/"><i class="fas fa-pen-fancy"></i> éƒ¨è½æ ¼</a></li>
          <li><a href="/knowledge/"><i class="fas fa-book"></i> çŸ¥è­˜åº«</a></li>
          <li><a href="/about/"><i class="fas fa-user"></i> é—œæ–¼æˆ‘</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="main-content">
    <div class="container">
      
<article class="post">
  <header class="post-header">
    <h1>Debianï¼Ubuntu ä½¿ç”¨ systemdâ€‘timesyncd èª¿æ•´ NTP Server å®Œæ•´æ•™å­¸</h1>
    <div class="post-meta">
      <time datetime="Wed May 01 2024 00:00:00 GMT+0000 (Coordinated Universal Time)">2024å¹´5æœˆ1æ—¥</time>
      
      <div class="post-tags">
        
          <span class="tag">knowledge</span>
        
          <span class="tag">linux</span>
        
          <span class="tag">ubuntu</span>
        
          <span class="tag">debian</span>
        
          <span class="tag">ntp</span>
        
          <span class="tag">systemd</span>
        
      </div>
      
    </div>
  </header>

  <div class="post-content">
    <h2>Debianï¼Ubuntu ä½¿ç”¨Â systemdâ€‘timesyncd èª¿æ•´ NTP Server å®Œæ•´æ•™å­¸</h2>
<blockquote>
<p>é©ç”¨ç‰ˆæœ¬ï¼šDebian 10ï¼‹ã€Ubuntu 18.04ï¼‹ï¼ˆå« 22.04ã€24.04ï¼‰<br>
ç›®çš„ï¼šæŠŠç³»çµ±çš„æ™‚é–“åŒæ­¥ä¾†æºï¼ˆNTP Serverï¼‰æ”¹æˆè‡ªå®¶çš„ <code>time.server.mydomain.com.tw</code>ï¼Œä¸¦é©—è­‰è¨­å®šæ˜¯å¦ç”Ÿæ•ˆã€‚</p>
</blockquote>
<hr>
<h3>1ï¸âƒ£ã€€ä¿®æ”¹Â systemdâ€‘timesyncd çš„ NTP Server</h3>
<ol>
<li>
<p><strong>ç·¨è¼¯è¨­å®šæª”</strong></p>
<pre><code class="language-bash">sudo nano /etc/systemd/timesyncd.conf
</code></pre>
<p>åœ¨ <code>[Time]</code> å€å¡ŠåŠ å…¥æˆ–ä¿®æ”¹ <code>NTP=</code>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code>[Time]
NTP=time.server.mydomain.com.tw
</code></pre>
<blockquote>
<p>è‹¥åŒæ™‚æƒ³ç•™å‚™æ´ï¼Œå¯ç”¨ç©ºç™½åˆ†éš”ï¼š<br>
<code>NTP=time.server.mydomain.com.tw 1.1.1.1 8.8.8.8</code></p>
</blockquote>
</li>
<li>
<p><strong>é‡æ–°å•Ÿå‹•æœå‹™ä¸¦ç¢ºä¿é–‹æ©Ÿè‡ªå‹•å•Ÿç”¨</strong></p>
<pre><code class="language-bash">sudo systemctl restart systemd-timesyncd
sudo systemctl enable systemd-timesyncd
</code></pre>
</li>
</ol>
<hr>
<h3>2ï¸âƒ£ã€€ç¢ºèª NTP Server å·²æ­£ç¢ºå¥—ç”¨</h3>
<pre><code class="language-bash">timedatectl timesync-status      # Debian 12+/Ubuntu 22.04+

# èˆŠç‰ˆç³»çµ±ç”¨
timedatectl status
</code></pre>
<p>é‡é»æ¬„ä½è§£è®€ï¼š</p>
<table>
<thead>
<tr>
<th>æ¬„ä½</th>
<th>ä»£è¡¨æ„æ€</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Server:</code></td>
<td>æ­£åœ¨ä½¿ç”¨çš„ NTP Serverï¼Œæ‡‰é¡¯ç¤º <code>time.server.mydomain.com.tw</code></td>
</tr>
<tr>
<td><code>Leap:</code></td>
<td>æ˜¯å¦é–ç§’è³‡è¨Šæ­£å¸¸</td>
</tr>
<tr>
<td><code>Offset:</code></td>
<td>æœ¬æ©Ÿæ™‚é–“èˆ‡ä¼ºæœå™¨å·®è·ï¼Œå¹¾åæ¯«ç§’ä»¥å…§å±¬æ­£å¸¸</td>
</tr>
<tr>
<td><code>Poll:</code></td>
<td>ä¸‹æ¬¡åŒæ­¥é–“éš”ï¼ŒåˆæœŸè¼ƒçŸ­ï¼Œç©©å®šå¾Œå¯é•·é” 64Â min</td>
</tr>
</tbody>
</table>
<hr>
<h2>ğŸ”§ å¸¸è¦‹ QAï¼é™¤éŒ¯</h2>
<h3>Q1ï¼šæ€éº¼æŸ¥æˆ‘çš„ç³»çµ±ç›®å‰è·‘å“ªä¸€æ¬¾ NTP åŒæ­¥å·¥å…·ï¼Ÿ</h3>
<pre><code class="language-bash">systemctl list-unit-files | grep -E 'timesync|ntp|chrony'
</code></pre>
<table>
<thead>
<tr>
<th>çœ‹åˆ°çš„æœå‹™</th>
<th>ä»£è¡¨ç”¨çš„æ˜¯</th>
<th>ç‹€æ…‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>systemd-timesyncd.service</code></td>
<td><strong>systemdâ€‘timesyncd</strong></td>
<td>å»ºè­°é–‹å•Ÿ</td>
</tr>
<tr>
<td><code>ntpsec.service</code>ã€<code>ntpd.service</code></td>
<td><strong>ntpsec / ntpd</strong></td>
<td>äºŒæ“‡ä¸€</td>
</tr>
<tr>
<td><code>chrony.service</code></td>
<td><strong>chrony</strong></td>
<td>å»ºè­°ç”¨æ–¼å¤§è¦æ¨¡æˆ–éœ€è¦é«˜ç²¾åº¦æ™‚</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>åŸå‰‡ï¼šåªç•™ä¸€å¥—ã€‚</strong> å¤šå¥—åŒæ™‚é–‹æœƒäº’æ¶ UDPÂ 123ï¼Œå°è‡´æ™‚é–“æ¼‚ç§»ã€‚</p>
</blockquote>
<hr>
<h3>Q2ï¼šå¦‚æœæˆ‘ç¾åœ¨ä¸æ˜¯ç”¨Â systemdâ€‘timesyncdï¼Œè¦æ€éº¼è£å›ä¾†ï¼Ÿ</h3>
<ol>
<li>
<p>åœç”¨ç¾æœ‰ NTP æœå‹™ï¼ˆä»¥ ntpsec ç‚ºä¾‹ï¼‰</p>
<pre><code class="language-bash">sudo systemctl disable --now ntpsec.service
</code></pre>
</li>
<li>
<p>å®‰è£æˆ–é‡è£ <code>systemd-timesyncd</code></p>
<ul>
<li>
<p><strong>Debian 12ï¼Ubuntu 22.04â†‘</strong>ï¼š</p>
<pre><code class="language-bash">sudo apt install --reinstall systemd
</code></pre>
<p>timesyncd å·²éš¨ systemd æ‰“åŒ…ã€‚</p>
</li>
<li>
<p><strong>èˆŠç‰ˆï¼ˆDebian 11 ä»¥ä¸‹ï¼‰</strong>ï¼š</p>
<pre><code class="language-bash">sudo apt install systemd-timesyncd
</code></pre>
</li>
</ul>
</li>
<li>
<p>å•Ÿç”¨ä¸¦ç«‹å³å•Ÿå‹•</p>
<pre><code class="language-bash">sudo systemctl enable --now systemd-timesyncd
</code></pre>
</li>
<li>
<p>ä¾å‰è¿°æ­¥é©Ÿè¨­å®š <code>NTP=</code> å³å¯ã€‚</p>
</li>
</ol>
<hr>
<h3>Q3ï¼šsystemdâ€‘timesyncd è·Ÿå…¶ä»– NTP å¥—ä»¶å·®åœ¨å“ªï¼Ÿ</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th><strong>systemdâ€‘timesyncd</strong></th>
<th><strong>chrony</strong></th>
<th><strong>ntpsec / ntpd</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>è§’è‰²</td>
<td>è¼•é‡ <strong>SNTP Client</strong></td>
<td>å…¨åŠŸèƒ½ NTPv4ï¼ˆå®¢æˆ¶ç«¯ï¼‹ä¼ºæœå™¨ï¼‰</td>
<td>å…¨åŠŸèƒ½ NTPv4ï¼ˆå®¢æˆ¶ç«¯ï¼‹ä¼ºæœå™¨ï¼‰</td>
</tr>
<tr>
<td>ç²¾æº–åº¦</td>
<td>ms ç´šï¼Œæ—¥å¸¸æœå‹™è¶³å¤ </td>
<td>Î¼s ç´šï¼Œæ”¶æ–‚å¿«ï¼Œé›²ç«¯ç’°å¢ƒå‹å–„</td>
<td>Î¼s ç´šï¼Œå¯æ”¯æ´ PPSï¼GPS</td>
</tr>
<tr>
<td>æ”¯æ´ NTS åŠ å¯†</td>
<td>âŒ</td>
<td>âœ…</td>
<td>âœ…ï¼ˆntpsecï¼‰</td>
</tr>
<tr>
<td>å¯ç•¶å…§ç¶² NTP Server</td>
<td>âŒ</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>å®‰è£é›£åº¦</td>
<td>å…§å»ºã€é›¶ä¾è³´</td>
<td>éœ€é¡å¤–å®‰è£</td>
<td>éœ€é¡å¤–å®‰è£</td>
</tr>
<tr>
<td>å…¸å‹ä½¿ç”¨æƒ…å¢ƒ</td>
<td>VMã€å°å‹æœå‹™ã€IoT</td>
<td>å¤§é‡ä¼ºæœå™¨ã€é«˜ç²¾åº¦éœ€æ±‚</td>
<td>ç§‘ç ”ã€é‡‘èã€æƒ³ç”¨ NTS</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ç°¡å–®é¸æ“‡ï¼š</p>
<ul>
<li>
<p><strong>åªè¦æŠŠæ™‚é–“æŠ“æº–</strong> â†’ ç”¨ <strong>systemdâ€‘timesyncd</strong>ã€‚</p>
</li>
<li>
<p><strong>è¦ç•¶ NTP ä¼ºæœå™¨ã€é›²ç«¯å¤§è¦æ¨¡</strong> â†’ è€ƒæ…® <strong>chrony</strong>ã€‚</p>
</li>
<li>
<p><strong>éœ€è¦ NTS æˆ–è¶…é«˜ç²¾åº¦</strong> â†’ è€ƒæ…® <strong>ntpsec</strong>ã€‚</p>
</li>
</ul>
</blockquote>
<hr>
<h2>â˜‘ï¸ã€€æª¢æŸ¥æ¸…å–®ï¼ˆåšå®Œå¯ä»¥é€é …æ‰“å‹¾ï¼‰</h2>
<ul>
<li>
<p><code>/etc/systemd/timesyncd.conf</code> å·²å¯«å…¥æ­£ç¢º <code>NTP=time.server.mydomain.com.tw</code></p>
</li>
<li>
<p><code>systemctl status systemd-timesyncd</code> é¡¯ç¤º <code>active (running)</code></p>
</li>
<li>
<p><code>timedatectl timesync-status</code> çš„ <strong>Server</strong> è¡ŒæŒ‡å‘æ–°ä¼ºæœå™¨</p>
</li>
<li>
<p><code>Offset</code> æ•¸å€¼åœ¨æ•¸åæ¯«ç§’ä»¥å…§ä¸¦ç©©å®š</p>
</li>
<li>
<p><code>ss -ulpn | grep :123</code> ç¢ºå®šåªæœ‰ <code>systemd-timesyncd</code> ä½”ç”¨ UDPÂ 123</p>
</li>
</ul>
<p>å…¨éƒ¨é€šéï¼Œå°±ä»£è¡¨ä½ çš„ Debianï¼Ubuntu å·²ç¶“æˆåŠŸæ”¹ç”¨è‡ªå®¶ NTP Serverï¼ŒåŒæ­¥ç„¡è™ï¼ğŸ‘</p>

  </div>
</article>

    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-branding">
          <h2><i class="fas fa-terminal"></i> WhyBlog</h2>
          <p class="footer-tagline">åˆ†äº«æŠ€è¡“èˆ‡ç”Ÿæ´»çš„å€‹äººéƒ¨è½æ ¼</p>
        </div>
        <div class="footer-nav">
          <h3>å°èˆª</h3>
          <ul>
            <li><a href="/">é¦–é </a></li>
            <li><a href="/blog/">éƒ¨è½æ ¼</a></li>
            <li><a href="/knowledge/">çŸ¥è­˜åº«</a></li>
            <li><a href="/about/">é—œæ–¼æˆ‘</a></li>
          </ul>
        </div>
        <div class="footer-social">
          <h3>ç¤¾ç¾¤é€£çµ</h3>
          <div class="social-icons">
            <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
            <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
            <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 WhyBlog. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- JavaScript -->
  <script>
    // Mobile navigation toggle
    document.querySelector('.menu-toggle').addEventListener('click', function() {
      document.querySelector('.nav-links').classList.toggle('active');
      this.classList.toggle('active');
    });
  </script>
</body>
</html>